CSRCS  = $(wildcard *.cc)
CHDRS  = $(wildcard *.h)
COBJS  = $(addsuffix .o, $(basename $(CSRCS)))

EXTINCDIR = ../../include
DEPENDDIR = -I. -I$(EXTINCDIR) -I`root-config --incdir` 
LIBDIR    = ../../lib
EXTLINK   = $(PKGNAME).d
LIBDEPEND = $(LIBDIR)/lib.d

CXX   = g++
AR    = ar rcs
ECHO  = /bin/echo

ROOTFLAGS = `root-config --cflags --glibs`

CFLAGS = -O2 -Wall -std=c++11 $(PKGFLAG) $(ROOTFLAGS)
CFLAGS = -g -Wall  -std=c++11 $(PKGFLAG) $(ROOTFLAGS)

.PHONY: .depend.mak .extheader.mak

%.o : %.cc
	@$(ECHO) "> compiling: $<"
	@$(CXX) $(CFLAGS) $(DEPENDDIR) -c -o $@ $<

top: $(EXTLINK) target
	@$(ECHO) -n

clean:
	@rm -f $(COBJS)

## Make dependencies
depend: .depend.mak

.depend.mak: $(CSRCS) $(CHDRS)
	@$(ECHO) Making dependencies ...
	@$(CXX) -MM -std=c++11 $(DEPENDDIR) $(CSRCS) > $@

## Linking external headers
extheader: .extheader.mak

.extheader.mak: $(EXTHDRS)
	@$(ECHO) Linking external header files...
	@rm -f $@
	@$(ECHO) -n "$(EXTLINK): " > $@
	@for hdr in $(EXTHDRS); \
		do \
		$(ECHO) -n "$(EXTINCDIR)/$$hdr " >> $@; \
		rm -f $(EXTINCDIR)/$$hdr; \
		done
	@$(ECHO) >> $@
	@for hdr in $(EXTHDRS); \
		do \
		$(ECHO) "$(EXTINCDIR)/$$hdr: $$hdr" >> $@; \
		$(ECHO) "       @rm -f $(EXTINCDIR)/$$hdr" >> $@; \
		$(ECHO) "       @ln -fs ../src/$(PKGNAME)/$$hdr $(EXTINCDIR)/$$hdr" >> $@; \
		done

include .extheader.mak
include .depend.mak

